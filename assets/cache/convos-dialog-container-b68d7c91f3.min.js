(function(){Vue.component("convos-dialog-container",{props:["dialog","user"],data:function(){return{atBottom:true,scrollElement:null,scrollThreshold:!!("ontouchstart" in window)?60:40};},watch:{'settings.windowHeight':function(v,o){if(this._atBottomTid)return;var atBottom=this.atBottom;this._atBottomTid=setTimeout(function(){this.scrollToBottom({gotoBottom:atBottom});this._atBottomTid=0;}.bind(this),300);}},methods:{onScroll:function(){var self=this;var elem=this.scrollElement;this.atBottom=elem.scrollHeight<elem.offsetHeight+this.scrollThreshold+elem.scrollTop;if(elem.scrollTop<this.scrollThreshold){this.dialog.historicMessages({},function(err,cb){var scrollHeight=elem.scrollHeight;if(cb)cb();if(self.atBottom)return self.scrollToBottom({});window.nextTick(function(){elem.scrollTop=elem.scrollHeight-scrollHeight-100;});});}},scrollToBottom:function(args){var elem=this.scrollElement;if(this.atBottom||args.gotoBottom){window.nextTick(function(){elem.scrollTop=elem.scrollHeight;});}},send:function(command){this.dialog.connection().send(command,this.dialog);}},ready:function(){this.scrollElement=$("main",this.$el)[0];this.scrollElement.addEventListener("scroll",this.onScroll);this.dialog.on("active",function(){this.scrollToBottom({gotoBottom:true});}.bind(this));this.dialog.on("message",this.scrollToBottom);},beforeDestroy:function(){this.scrollElement.removeEventListener("scroll",this.onScroll);},template:"<div class=\"convos-dialog-container\">\n    <header>\n      <convos-toggle-main-menu :user=\"user\"></convos-toggle-main-menu>\n      <h2 v-tooltip=\"dialog.topic || &#39;No topic is set.&#39;\">{{user.ws.is(&#39;open&#39;) ? dialog.name || &#39;Convos&#39; : &#39;No internet connection?&#39;}}</h2>\n      <convos-header-links :toggle=\"true\" :user=\"user\">\n        <a v-dropdown.literal=\"settings_dropdown\" v-tooltip.literal=\"Dialog settings\"><i class=\"material-icons\">settings</i></a>\n      </convos-header-links>\n    </header>\n    <main>\n      <component :dialog=\"dialog\" :is=\"&#39;convos-message-&#39; + msg.type\" :msg=\"msg\" :user=\"user\" v-for=\"msg in dialog.messages\" v-if=\"msg.type\"></component>\n    </main>\n    <convos-input :dialog=\"dialog\" :user=\"user\"></convos-input>\n    <ul class=\"dropdown-content\" v-el:settings_dropdown>\n      <li><a @click.prevent=\"send(&#39;/names&#39;)\" href=\"#names\">List participants</a></li>\n      <li><a @click.prevent=\"send(&#39;/topic&#39;)\" href=\"#topic\">Get topic</a></li>\n      <li class=\"divider\"></li>\n      <li><a @click.prevent=\"send(&#39;/close&#39;)\" href=\"#close\">Close dialog</a></li>\n    </ul>\n  </div>\n"})})();